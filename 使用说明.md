# SASEG Autoexec - 使用说明

## 功能概述

SASEG Autoexec（iSPA）是一个图形界面工具，用于快速选择 Z 盘路径并启动 SAS Enterprise Guide，同时支持按项目结构导航及 TFLs 相关操作。

## 项目文件说明

| 文件 | 说明 |
|------|------|
| `SASEG_GUI.py` | 主程序，图形界面与核心逻辑 |
| `tfls_pdt.py` | TFLs 页面「生成PDT」弹窗模块（独立模块） |
| `tfls_metadata.py` | TFLs 页面「Metadata Setup」弹窗模块（独立模块） |
| `requirements.txt` | Python 依赖（pywinauto, pyinstaller） |
| `build_exe.bat` | 打包为 exe 脚本（推荐） |
| `build_exe_advanced.bat` | 高级打包脚本（含更多优化选项） |
| `logo.png` | 程序图标 |
| `iSCEdemo_standalone.html` | 恒瑞 iSCE（Integrated Statistical Computing Environment）演示页面 |
| `README_BUILD.md` | 详细打包说明 |

---

## 主要功能

### 1. 路径选择

- 通过 6 个级联下拉框选择 Z 盘路径，可自由选择任意层级
- 下拉框支持**文本输入搜索**（不区分大小写），例如在项目级下拉框中输入 "SHR17"，会筛选出包含 "SHR17" 的所有项目

### 2. 多页面导航

- **主页**：显示「Hyperlinks to Sub Folders」与「Autoexec」标签页
- **aCRF**：pending
- **SDTM**：pending
- **ADaM**：pending
- **TFLs**：包含「生成PDT」「Metadata Setup」按钮
- **M5**：pending
- **pm**：pending

主页提供快速跳转按钮，可直接切换到上述各页面。

### 3. Subfolders 显示

- 选择至少 4 级路径后，显示当前路径下的子文件夹和文件
- 自动过滤：不显示 `00_source_data`、`91_export`、`92_import`、`99_archive`
- 点击列标题（文件夹名）用 Windows 资源管理器打开
- 点击文件按类型打开（见下方「文件打开规则」）

### 4. 文件打开规则

| 类型 | 打开方式 |
|------|----------|
| 文件夹 | Windows 资源管理器 |
| `.sas` 文件 | SAS EG（路径自动转换为映射路径） |
| `.sas7bdat` 文件 | SAS EG（路径自动转换为映射路径） |
| `.xml` 文件（在 `09_validation` 或 `07_logs` 下） | Excel |
| `.ps1` 文件 | 不可点击 |

### 5. TFLs 页面 - 生成 PDT

在 **TFLs** 页面点击「生成PDT」按钮，会弹出分步对话框：

- **第一步**：填写分析设计类型（SAD/FE/MAD/BE/MB）、其他终点（PK浓度、PK参数、PD/ADA/QT 等），以及分析物名称（若选择 PK 相关终点）
- **第二步**：选择 TOC_template.xlsx 与项目层面 PDT.xlsx，基于 TOC 模板在原 PDT 基础上增加对应 TFLs，生成最新版 PDT
- 支持「确定」保存选择，以及「打开并编辑」直接打开 PDT 文件

### 6. TFLs 页面 - Metadata Setup

在 **TFLs** 页面点击「Metadata Setup」按钮，弹出对话框：

- **第一步**：受试者分布 T14_1-1_1.xlsx 初始化设置
  - 默认路径：前四个下拉框拼接 + `\utility\metadata\T14_1-1_1.xlsx`
  - **初版T14_1-1_1**：若文件不存在，则创建 `utility\metadata` 目录并生成空白 T14_1-1_1.xlsx（含「受试者分布」表）
  - **更新**：打开当前路径下的 T14_1-1_1.xlsx 进行审阅/编辑

### 7. Launch SAS EG

- 点击「Launch SAS EG」按钮启动 SAS Enterprise Guide
- 自动导航到当前选择的 Z 盘路径（路径会转换为映射路径）

### 8. Refresh Access

- 点击「Refresh Access」按钮清空所有下拉框并重新扫描 Z 盘

---

## 使用方法

### 启动程序

**方式一：直接运行 Python 脚本**

```bash
pip install -r requirements.txt
python SASEG_GUI.py
```

**方式二：使用打包后的 exe**

1. 运行 `build_exe.bat` 打包（参见 [README_BUILD.md](README_BUILD.md)）
2. 双击 `dist\SASEG_Autoexec.exe` 启动

### 操作步骤

1. **选择路径**：依次从 6 个下拉框中选择路径层级（或输入关键字搜索）
2. **查看 Subfolders**：选择至少 4 级路径后，下方显示子文件夹和文件；可使用主页快速按钮跳转到指定页面
3. **打开文件/文件夹**：点击列标题打开文件夹，点击文件名打开文件
4. **生成 PDT / Metadata Setup**（可选）：切换到 TFLs 页面，点击「生成PDT」或「Metadata Setup」，按弹窗提示操作
5. **启动 SAS EG**：选择路径后点击「Launch SAS EG」
6. **刷新**：点击「Refresh Access」重新扫描路径

---

## 系统要求

- Windows 操作系统
- SAS Enterprise Guide 已安装
- SAS EG 界面为中文版
- Z 盘已映射到网络驱动器

---

## 注意事项

1. 确保 Z 盘已正确映射
2. 确保有访问 Z 盘的权限
3. 首次使用可能需要等待路径扫描完成
4. 打包为 exe 的详细说明见 [README_BUILD.md](README_BUILD.md)
